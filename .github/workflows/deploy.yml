name: Build C++ Zakat App to Web

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3
      
    - name: Setup Emscripten
      run: |
        git clone https://github.com/emscripten-core/emsdk.git
        cd emsdk
        ./emsdk install 3.1.55
        ./emsdk activate 3.1.55
        echo "EMSDK_PATH=$(pwd)/emsdk" >> $GITHUB_ENV
        
    - name: Compile Program C++ ke WebAssembly
      run: |
        source $EMSDK_PATH/emsdk_env.sh
        
        echo "ðŸ”§ Kompilasi program.cpp..."
        
        # Kompilasi untuk WebAssembly
        emcc program.cpp \
          -o zakat_app.html \
          -s WASM=1 \
          -s EXPORTED_FUNCTIONS='["_main"]' \
          -s EXPORTED_RUNTIME_METHODS='["ccall", "cwrap"]' \
          -s ALLOW_MEMORY_GROWTH=1 \
          -s ENVIRONMENT=web \
          --shell-file minimal.html \
          -O2
        
        echo "âœ… Kompilasi selesai!"
        ls -la *.html *.wasm *.js
        
    - name: Deploy ke GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: .
        publish_branch: gh-pages
